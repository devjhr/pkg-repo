<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AndroStudio - Package Repository</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,700;1,300&family=Bebas+Neue&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    /* DARK theme (default) */
    :root {
      --bg: #060809; --surface: #0b0f12; --border: #1a2028;
      --green: #00cc6a; --green-dim: rgba(0,204,106,0.07);
      --text: #cdd8e3; --muted: #445566; --amber: #ffb347; --blue: #4fc3f7;
      --header-bg: #0d1219;
    }
    /* LIGHT theme */
    :root.light {
      --bg: #f4f6f9; --surface: #ffffff; --border: #dde2ec;
      --green: #00925a; --green-dim: rgba(0,146,90,0.07);
      --text: #1a2030; --muted: #7a8aa0; --amber: #c07000; --blue: #0077bb;
      --header-bg: #eef1f6;
    }
    /* Smooth theme transition */
    *, *::before, *::after { transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; }
    /* But keep animations instant */
    .reveal, .status-dot, .copy-btn, .fm-dl-btn, .fm-row, .fm-search, .nav-links a { transition: none !important; }
    .reveal { transition: opacity 0.5s, transform 0.5s !important; }
    .copy-btn, .fm-dl-btn { transition: border-color 0.2s, color 0.2s !important; }
    .fm-row { transition: background 0.12s !important; }
    .fm-search { transition: border-color 0.2s !important; }
    html { scroll-behavior: smooth; }
    body { background: var(--bg); color: var(--text); font-family: 'JetBrains Mono', monospace; min-height: 100vh; overflow-x: hidden; }
    body::after { content: ''; position: fixed; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px); pointer-events: none; z-index: 9999; }
    body::before { content: ''; position: fixed; inset: 0; background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px); background-size: 40px 40px; opacity: 0.25; pointer-events: none; }

    /* TOPBAR */
    .topbar { background: var(--surface); border-bottom: 1px solid var(--border); padding: 10px 40px; display: flex; align-items: center; gap: 12px; font-size: 0.7rem; color: var(--muted); position: sticky; top: 0; z-index: 100; }
    .topbar-dot { width: 8px; height: 8px; border-radius: 50%; }
    .dot-red { background: #ff5f57; } .dot-yellow { background: #febc2e; } .dot-green { background: #28c840; }
    .topbar-title { margin-left: 16px; color: var(--text); font-size: 0.72rem; }
    .topbar-status { margin-left: auto; display: flex; align-items: center; gap: 8px; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: blink 2s infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    /* HERO */
    .hero { padding: 80px 40px 60px; max-width: 960px; margin: 0 auto; }
    .hero-label { font-size: 0.68rem; letter-spacing: 0.2em; color: var(--green); text-transform: uppercase; margin-bottom: 20px; display: block; opacity: 0; animation: fadeIn 0.6s 0.1s forwards; }
    .hero-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(4rem,10vw,9rem); line-height: 0.9; color: var(--text); margin-bottom: 8px; opacity: 0; animation: fadeIn 0.6s 0.2s forwards; }
    .hero-title span { color: var(--green); }
    .hero-sub { font-family: 'Bebas Neue', sans-serif; font-size: clamp(1.5rem,4vw,3rem); color: var(--muted); margin-bottom: 40px; opacity: 0; animation: fadeIn 0.6s 0.3s forwards; }
    .hero-desc { font-size: 0.82rem; line-height: 1.9; color: var(--muted); max-width: 560px; margin-bottom: 50px; opacity: 0; animation: fadeIn 0.6s 0.4s forwards; }

    /* INSTALL */
    .install-block { background: var(--surface); border: 1px solid var(--border); border-left: 3px solid var(--green); padding: 24px 28px; margin-bottom: 14px; opacity: 0; animation: fadeIn 0.6s 0.5s forwards; }
    .install-block-label { font-size: 0.62rem; letter-spacing: 0.18em; color: var(--green); text-transform: uppercase; margin-bottom: 14px; display: block; }
    .cmd-line { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .cmd-line:last-child { margin-bottom: 0; }
    .prompt { color: var(--green); font-size: 0.85rem; user-select: none; }
    .cmd { font-size: 0.85rem; color: var(--text); flex: 1; word-break: break-all; }
    .copy-btn { background: none; border: 1px solid var(--border); color: var(--muted); font-family: 'JetBrains Mono', monospace; font-size: 0.62rem; letter-spacing: 0.1em; padding: 4px 10px; cursor: pointer; text-transform: uppercase; white-space: nowrap; transition: border-color 0.2s, color 0.2s; }
    .copy-btn:hover { border-color: var(--green); color: var(--green); }
    .copy-btn.copied { color: var(--green); border-color: var(--green); }

    /* DIVIDER */
    .divider { display: flex; align-items: center; gap: 16px; margin: 60px 0 40px; }
    .divider-line { flex: 1; height: 1px; background: var(--border); }
    .divider-text { font-size: 0.68rem; letter-spacing: 0.18em; color: var(--muted); text-transform: uppercase; white-space: nowrap; }

    /* FILE MANAGER */
    .fm-section { max-width: 960px; margin: 0 auto; padding: 0 40px 80px; }
    .fm-toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; flex-wrap: wrap; }
    .fm-search { flex: 1; min-width: 180px; background: var(--surface); border: 1px solid var(--border); color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; padding: 8px 14px; outline: none; transition: border-color 0.2s; }
    .fm-search:focus { border-color: var(--green); }
    .fm-search::placeholder { color: var(--muted); }
    .fm-count { font-size: 0.68rem; color: var(--muted); white-space: nowrap; }
    .fm-shell { border: 1px solid var(--border); background: var(--surface); overflow: hidden; }
    /* Desktop: icon | name | version | size | action */
    .fm-header { display: grid; grid-template-columns: 28px 1fr 100px 80px 110px; padding: 10px 16px; border-bottom: 1px solid var(--border); background: var(--header-bg); font-size: 0.62rem; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); user-select: none; }
    .fm-row { display: grid; grid-template-columns: 28px 1fr 100px 80px 110px; padding: 0 16px; border-bottom: 1px solid var(--border); align-items: center; min-height: 50px; cursor: default; transition: background 0.12s; text-decoration: none; color: inherit; }
    .fm-row:last-child { border-bottom: none; }
    .fm-row:hover { background: var(--green-dim); }
    .fm-icon { font-size: 0.95rem; }
    .fm-name { font-size: 0.8rem; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 12px; }
    .fm-version { font-size: 0.7rem; color: var(--amber); white-space: nowrap; }
    .fm-size { font-size: 0.7rem; color: var(--muted); white-space: nowrap; }
    .fm-action { display: flex; justify-content: flex-end; }
    .fm-dl-btn { font-family: 'JetBrains Mono', monospace; font-size: 0.62rem; letter-spacing: 0.08em; text-transform: uppercase; padding: 5px 12px; border: 1px solid var(--border); color: var(--muted); text-decoration: none; transition: border-color 0.2s, color 0.2s; white-space: nowrap; display: inline-flex; align-items: center; gap: 6px; }
    .fm-dl-btn:hover { border-color: var(--green); color: var(--green); }
    .fm-dl-btn:hover svg { stroke: var(--green); }
    .fm-dl-btn svg { stroke: var(--muted); transition: stroke 0.2s; flex-shrink: 0; }
    .fm-dl-text { }
    .fm-empty { padding: 52px; text-align: center; font-size: 0.78rem; color: var(--muted); line-height: 1.8; }

    /* SKELETON LOADING */
    .fm-skeleton { pointer-events: none; }
    .fm-skeleton .fm-name,
    .fm-skeleton .fm-version,
    .fm-skeleton .fm-size,
    .fm-skeleton .fm-action { position: relative; overflow: hidden; border-radius: 3px; background: var(--border); color: transparent !important; border-color: transparent !important; }
    .fm-skeleton .fm-name::after,
    .fm-skeleton .fm-version::after,
    .fm-skeleton .fm-size::after,
    .fm-skeleton .fm-action::after {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.06) 50%, transparent 100%);
      animation: shimmer 1.4s infinite;
    }
    @keyframes shimmer { from { transform: translateX(-100%); } to { transform: translateX(100%); } }

    /* LOAD MORE */
    .fm-load-more { display: flex; justify-content: center; padding: 20px 0 8px; }
    .fm-load-btn { background: none; border: 1px solid var(--border); color: var(--muted); font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; letter-spacing: 0.1em; padding: 8px 24px; cursor: pointer; text-transform: uppercase; transition: border-color 0.2s, color 0.2s !important; }
    .fm-load-btn:hover { border-color: var(--green); color: var(--green); }

    /* HOW IT WORKS */
    .how-section { max-width: 960px; margin: 0 auto; padding: 0 40px 80px; }
    .steps { display: flex; flex-direction: column; }
    .step { display: flex; border: 1px solid var(--border); border-bottom: none; background: var(--surface); overflow: hidden; }
    .step:last-child { border-bottom: 1px solid var(--border); }
    .step-num { padding: 24px; background: var(--green-dim); border-right: 1px solid var(--border); font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--green); min-width: 70px; text-align: center; display: flex; align-items: center; justify-content: center; }
    .step-content { padding: 24px 28px; }
    .step-title { font-size: 0.82rem; font-weight: 700; color: var(--text); margin-bottom: 8px; }
    .step-body { font-size: 0.74rem; color: var(--muted); line-height: 1.7; }
    .step-code { font-size: 0.75rem; color: var(--green); background: rgba(0,255,136,0.06); border: 1px solid var(--border); padding: 8px 14px; margin-top: 10px; display: inline-block; }

    /* THEME TOGGLE */
    .theme-toggle { background: none; border: 1px solid var(--border); color: var(--muted); font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; letter-spacing: 0.1em; padding: 5px 12px; cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 6px; transition: border-color 0.2s, color 0.2s !important; white-space: nowrap; }
    .theme-toggle:hover { border-color: var(--green); color: var(--green); }
    .theme-icon { font-size: 0.85rem; transition: transform 0.4s ease !important; }
    :root.light .theme-icon { transform: rotate(180deg); }

    /* FOOTER */
    footer { border-top: 1px solid var(--border); padding: 28px 40px; display: flex; justify-content: space-between; align-items: center; font-size: 0.68rem; color: var(--muted); }
    .footer-logo { color: var(--green); font-weight: 700; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    .reveal { opacity: 0; transform: translateY(20px); transition: opacity 0.5s, transform 0.5s; }
    .reveal.visible { opacity: 1; transform: translateY(0); }

    @media (max-width: 640px) {
      .hero { padding: 40px 16px 40px; }
      .fm-section, .how-section { padding-left: 16px; padding-right: 16px; }
      .topbar { padding: 8px 12px; gap: 8px; }
      .topbar-title { font-size: 0.65rem; margin-left: 8px; }
      .topbar-status { gap: 5px; font-size: 0.65rem; }
      .theme-toggle { font-size: 0.6rem; padding: 4px 8px; }

      /* Mobile grid: icon | name | action only — hide version & size */
      .fm-header { grid-template-columns: 28px 1fr 90px; }
      .fm-row    { grid-template-columns: 28px 1fr 90px; min-height: 48px; }
      .fm-header > :nth-child(3),
      .fm-header > :nth-child(4),
      .fm-row    > :nth-child(3),
      .fm-row    > :nth-child(4) { display: none; }

      /* Show version + size as subtitle under name */
      .fm-name-wrap { display: flex; flex-direction: column; gap: 2px; overflow: hidden; }
      .fm-name      { padding-right: 8px; }
      .fm-meta      { display: none; }

      footer { flex-direction: column; gap: 10px; text-align: center; }
      .fm-dl-text { display: none; }
      .fm-dl-btn { padding: 6px 10px; }
      .fm-meta { display: flex; font-size: 0.62rem; color: var(--muted); gap: 6px; margin-top: 2px; }
      .fm-meta .ver { color: var(--amber); }
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="topbar-dot dot-red"></div>
    <div class="topbar-dot dot-yellow"></div>
    <div class="topbar-dot dot-green"></div>
    <span class="topbar-title">androstudio &mdash; pkg repository</span>
    <div class="topbar-status"><div class="status-dot"></div><span>repo online</span></div>
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode">
      <span class="theme-icon" id="themeIcon">&#9790;</span>
      <span id="themeLabel">Light</span>
    </button>
  </div>

  <div class="hero">
    <span class="hero-label">// Official Package Repository</span>
    <h1 class="hero-title">Andro<span>Studio</span></h1>
    <p class="hero-sub">PKG Repository</p>
    <p class="hero-desc">
      Official package repository for AndroStudio's built-in terminal.
      Built for <strong style="color:var(--text)">aarch64</strong> Android devices.
    </p>
    <div class="install-block">
      <span class="install-block-label">Install a package</span>
      <div class="cmd-line">
        <span class="prompt">$</span><span class="cmd" id="cmd1">pkg install git</span>
        <button class="copy-btn" onclick="copyCmd('cmd1',this)">copy</button>
      </div>
      <div class="cmd-line">
        <span class="prompt">$</span><span class="cmd" id="cmd2">pkg install python</span>
        <button class="copy-btn" onclick="copyCmd('cmd2',this)">copy</button>
      </div>
      <div class="cmd-line">
        <span class="prompt">$</span><span class="cmd" id="cmd3">pkg install micro</span>
        <button class="copy-btn" onclick="copyCmd('cmd3',this)">copy</button>
      </div>
    </div>
  </div>

  <div class="fm-section">
    <div class="divider reveal">
      <div class="divider-line"></div>
      <span class="divider-text">pool / main</span>
      <div class="divider-line"></div>
    </div>

    

    <div class="fm-toolbar reveal">
      <input class="fm-search" id="searchInput" type="text" placeholder="Search packages..." oninput="onSearch()"/>
      <span class="fm-count" id="itemCount"></span>
    </div>

    <div class="fm-shell reveal">
      <div class="fm-header">
        <div></div><div>Name</div><div>Version</div><div>Size</div><div></div>
      </div>
      <div id="fmBody"><div class="fm-empty">Loading packages...</div></div>
    </div>
  </div>

  <!-- How It Works -->
  <div class="how-section">
    <div class="divider reveal">
      <div class="divider-line"></div>
      <span class="divider-text">How It Works</span>
      <div class="divider-line"></div>
    </div>
    <div class="steps">
      <div class="step reveal">
        <div class="step-num">1</div>
        <div class="step-content">
          <p class="step-title">Open AndroStudio Terminal</p>
          <p class="step-body">Launch AndroStudio on your Android device and open the built-in Termux terminal from the sidebar or terminal tab.</p>
        </div>
      </div>
      <div class="step reveal">
        <div class="step-num">2</div>
        <div class="step-content">
          <p class="step-title">Update Package Index</p>
          <p class="step-body">Fetch the latest package list from all repositories including this one.</p>
          <code class="step-code">pkg update</code>
        </div>
      </div>
      <div class="step reveal">
        <div class="step-num">3</div>
        <div class="step-content">
          <p class="step-title">Install Any Package</p>
          <p class="step-body">Install packages by name. Multiple packages can be installed in a single command.</p>
          <code class="step-code">pkg install git python nano curl</code>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <span><span class="footer-logo">AndroStudio</span> &mdash; PKG Repository &middot; aarch64</span>
    <span>Hosted on GitHub Pages &middot; <a href="https://github.com/devjhr" style="color:var(--green);text-decoration:none;">@devjhr</a></span>
  </footer>

  <script>
    const REPO_BASE  = 'https://devjhr.github.io/pkg-repo';
    const PAGE_SIZE  = 30;   // packages shown per page
    let allPackages  = [];   // full sorted flat list
    let filtered     = [];   // current filtered results
    let visibleCount = PAGE_SIZE;
    let searchTimer  = null; // debounce timer

    // ── Show skeleton rows while loading ──────────────────────────────────────
    function showSkeleton() {
      const body = document.getElementById('fmBody');
      let html = '';
      for (let i = 0; i < 8; i++) {
        html += '<div class="fm-row fm-skeleton">' +
          '<div class="fm-icon">&#128230;</div>' +
          '<div class="fm-name-wrap"><div class="fm-name" style="width:' + (60+Math.random()*80|0) + 'px">████</div></div>' +
          '<div class="fm-version">███████</div>' +
          '<div class="fm-size">██████</div>' +
          '<div class="fm-action fm-dl-btn" style="width:40px">██</div>' +
        '</div>';
      }
      body.innerHTML = html;
      document.getElementById('itemCount').textContent = 'Loading...';
    }

    // ── Fetch packages.json ───────────────────────────────────────────────────
    showSkeleton();
    fetch('packages.json')
      .then(r => { if (!r.ok) throw new Error(r.status); return r.json(); })
      .then(data => {
        // Flatten { "m": { "micro": [{...}] } } → flat array
        for (const pkgs of Object.values(data))
          for (const files of Object.values(pkgs))
            files.forEach(f => allPackages.push(f));
        allPackages.sort((a, b) => (a.package||'').localeCompare(b.package||''));
        filtered = allPackages;
        visibleCount = PAGE_SIZE;
        renderView();
      })
      .catch(err => {
        document.getElementById('fmBody').innerHTML =
          '<div class="fm-empty">&#9888; Failed to load packages.json<br>' +
          '<span style="font-size:0.68rem;color:var(--muted)">' + err + '</span><br><br>' +
          'Run <strong style="color:var(--green)">python generate_repo.py</strong> then push to GitHub.</div>';
        document.getElementById('itemCount').textContent = '';
      });

    // ── Search with debounce (no lag while typing) ────────────────────────────
    function onSearch() {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => {
        const query = document.getElementById('searchInput').value.trim().toLowerCase();
        filtered = query
          ? allPackages.filter(f =>
              (f.package||'').toLowerCase().includes(query) ||
              (f.name||'').toLowerCase().includes(query) ||
              (f.desc||'').toLowerCase().includes(query))
          : allPackages;
        visibleCount = PAGE_SIZE;
        renderView();
      }, 180);  // 180ms debounce
    }

    // ── Render current page ───────────────────────────────────────────────────
    function renderView() {
      const body    = document.getElementById('fmBody');
      const total   = filtered.length;
      const visible = filtered.slice(0, visibleCount);
      const query   = document.getElementById('searchInput').value.trim();

      // Count label
      document.getElementById('itemCount').textContent =
        query
          ? total + ' result' + (total !== 1 ? 's' : '')
          : total + ' package' + (total !== 1 ? 's' : '') + ' total';

      if (!total) {
        body.innerHTML = '<div class="fm-empty">No packages match &quot;' + escHtml(query) + '&quot;</div>';
        return;
      }

      // Render rows using DocumentFragment for performance
      const frag = document.createDocumentFragment();
      visible.forEach(f => {
        const div = document.createElement('div');
        div.className = 'fm-row';
        if (f.desc) div.title = f.desc;
        const ver  = escHtml(f.version || '');
        const size = f.size ? (f.size/1024).toFixed(0)+' KB' : '';
        div.innerHTML =
          '<div class="fm-icon">&#128230;</div>' +
          '<div class="fm-name-wrap">' +
            '<div class="fm-name">' + escHtml(f.package||f.name) + '</div>' +
            '<div class="fm-meta"><span class="ver">' + ver + '</span>' + size + '</div>' +
          '</div>' +
          '<div class="fm-version">' + ver + '</div>' +
          '<div class="fm-size">' + (size||'-') + '</div>' +
          '<div class="fm-action"><a class="fm-dl-btn" href="' + REPO_BASE + '/' + f.path + '" download>' +
            '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v13M7 11l5 5 5-5"/><path d="M5 20h14"/></svg><span class="fm-dl-text">Download</span></a></div>';
        frag.appendChild(div);
      });

      body.innerHTML = '';
      body.appendChild(frag);

      // Load more button
      if (visibleCount < total) {
        const remaining = total - visibleCount;
        const wrap = document.createElement('div');
        wrap.className = 'fm-load-more';
        wrap.innerHTML = '<button class="fm-load-btn" onclick="loadMore()">Load ' +
          Math.min(remaining, PAGE_SIZE) + ' more &nbsp;&#9660; &nbsp;(' + remaining + ' remaining)</button>';
        body.appendChild(wrap);
      }
    }

    // ── Load next page ────────────────────────────────────────────────────────
    function loadMore() {
      visibleCount += PAGE_SIZE;
      renderView();
      // Scroll to where the new items start
      const rows = document.querySelectorAll('#fmBody .fm-row');
      if (rows.length > PAGE_SIZE) {
        rows[rows.length - PAGE_SIZE]?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function escHtml(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function copyCmd(id, btn) {
      navigator.clipboard.writeText(document.getElementById(id).textContent).then(() => {
        btn.textContent = 'copied!'; btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'copy'; btn.classList.remove('copied'); }, 2000);
      });
    }

    // Scroll reveal
    const obs = new IntersectionObserver(entries => {
      entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
    }, { threshold: 0.1 });
    document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

    // ── Theme: auto-detect system preference, persist user choice ──────────
    const root        = document.documentElement;
    const toggleBtn   = document.getElementById('themeToggle');
    const themeIcon   = document.getElementById('themeIcon');
    const themeLabel  = document.getElementById('themeLabel');

    function applyTheme(isLight) {
      root.classList.toggle('light', isLight);
      themeIcon.innerHTML  = isLight ? '&#9788;' : '&#9790;';
      themeLabel.textContent = isLight ? 'Dark' : 'Light';
    }

    function toggleTheme() {
      const isLight = !root.classList.contains('light');
      applyTheme(isLight);
      localStorage.setItem('as-theme', isLight ? 'light' : 'dark');
    }

    // On load: check saved pref, else follow system
    (function() {
      const saved  = localStorage.getItem('as-theme');
      const system = window.matchMedia('(prefers-color-scheme: light)').matches;
      applyTheme(saved ? saved === 'light' : system);
    })();

    // Auto-switch when system preference changes (only if user hasn't manually set a pref)
    window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', e => {
      if (!localStorage.getItem('as-theme')) applyTheme(e.matches);
    });
  </script>
</body>
</html>



