<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AndroStudio - Package Repository</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,700;1,300&family=Bebas+Neue&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    /* DARK theme (default) */
    :root {
      --bg: #060809; --surface: #0b0f12; --border: #1a2028;
      --green: #00cc6a; --green-dim: rgba(0,204,106,0.07);
      --text: #cdd8e3; --muted: #445566; --amber: #ffb347; --blue: #4fc3f7;
      --header-bg: #0d1219;
    }
    /* LIGHT theme */
    :root.light {
      --bg: #f4f6f9; --surface: #ffffff; --border: #dde2ec;
      --green: #00925a; --green-dim: rgba(0,146,90,0.07);
      --text: #1a2030; --muted: #7a8aa0; --amber: #c07000; --blue: #0077bb;
      --header-bg: #eef1f6;
    }
    /* Smooth theme transition */
    *, *::before, *::after { transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; }
    /* But keep animations instant */
    .reveal, .status-dot, .copy-btn, .fm-dl-btn, .fm-row, .fm-search, .nav-links a { transition: none !important; }
    .reveal { transition: opacity 0.5s, transform 0.5s !important; }
    .copy-btn, .fm-dl-btn { transition: border-color 0.2s, color 0.2s !important; }
    .fm-row { transition: background 0.12s !important; }
    .fm-search { transition: border-color 0.2s !important; }
    html { scroll-behavior: smooth; }
    body { background: var(--bg); color: var(--text); font-family: 'JetBrains Mono', monospace; min-height: 100vh; overflow-x: hidden; }
    body::after { content: ''; position: fixed; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px); pointer-events: none; z-index: 9999; }
    body::before { content: ''; position: fixed; inset: 0; background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px); background-size: 40px 40px; opacity: 0.25; pointer-events: none; }

    /* TOPBAR */
    .topbar { background: var(--surface); border-bottom: 1px solid var(--border); padding: 10px 40px; display: flex; align-items: center; gap: 12px; font-size: 0.7rem; color: var(--muted); position: sticky; top: 0; z-index: 100; }
    .topbar-dot { width: 8px; height: 8px; border-radius: 50%; }
    .dot-red { background: #ff5f57; } .dot-yellow { background: #febc2e; } .dot-green { background: #28c840; }
    .topbar-title { margin-left: 16px; color: var(--text); font-size: 0.72rem; }
    .topbar-status { margin-left: auto; display: flex; align-items: center; gap: 8px; }
    .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: blink 2s infinite; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    /* HERO */
    .hero { padding: 80px 40px 60px; max-width: 960px; margin: 0 auto; }
    .hero-label { font-size: 0.68rem; letter-spacing: 0.2em; color: var(--green); text-transform: uppercase; margin-bottom: 20px; display: block; opacity: 0; animation: fadeIn 0.6s 0.1s forwards; }
    .hero-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(4rem,10vw,9rem); line-height: 0.9; color: var(--text); margin-bottom: 8px; opacity: 0; animation: fadeIn 0.6s 0.2s forwards; }
    .hero-title span { color: var(--green); }
    .hero-sub { font-family: 'Bebas Neue', sans-serif; font-size: clamp(1.5rem,4vw,3rem); color: var(--muted); margin-bottom: 40px; opacity: 0; animation: fadeIn 0.6s 0.3s forwards; }
    .hero-desc { font-size: 0.82rem; line-height: 1.9; color: var(--muted); max-width: 560px; margin-bottom: 50px; opacity: 0; animation: fadeIn 0.6s 0.4s forwards; }

    /* INSTALL */
    .install-block { background: var(--surface); border: 1px solid var(--border); border-left: 3px solid var(--green); padding: 24px 28px; margin-bottom: 14px; opacity: 0; animation: fadeIn 0.6s 0.5s forwards; }
    .install-block-label { font-size: 0.62rem; letter-spacing: 0.18em; color: var(--green); text-transform: uppercase; margin-bottom: 14px; display: block; }
    .cmd-line { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .cmd-line:last-child { margin-bottom: 0; }
    .prompt { color: var(--green); font-size: 0.85rem; user-select: none; }
    .cmd { font-size: 0.85rem; color: var(--text); flex: 1; word-break: break-all; }
    .copy-btn { background: none; border: 1px solid var(--border); color: var(--muted); font-family: 'JetBrains Mono', monospace; font-size: 0.62rem; letter-spacing: 0.1em; padding: 4px 10px; cursor: pointer; text-transform: uppercase; white-space: nowrap; transition: border-color 0.2s, color 0.2s; }
    .copy-btn:hover { border-color: var(--green); color: var(--green); }
    .copy-btn.copied { color: var(--green); border-color: var(--green); }

    /* DIVIDER */
    .divider { display: flex; align-items: center; gap: 16px; margin: 60px 0 40px; }
    .divider-line { flex: 1; height: 1px; background: var(--border); }
    .divider-text { font-size: 0.68rem; letter-spacing: 0.18em; color: var(--muted); text-transform: uppercase; white-space: nowrap; }

    /* FILE MANAGER */
    .fm-section { max-width: 960px; margin: 0 auto; padding: 0 40px 80px; }
    .fm-breadcrumb { display: flex; align-items: center; gap: 6px; font-size: 0.72rem; color: var(--muted); margin-bottom: 16px; flex-wrap: wrap; }
    .fm-breadcrumb a { color: var(--green); text-decoration: none; cursor: pointer; }
    .fm-breadcrumb a:hover { text-decoration: underline; }
    .fm-toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; flex-wrap: wrap; }
    .fm-search { flex: 1; min-width: 180px; background: var(--surface); border: 1px solid var(--border); color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; padding: 8px 14px; outline: none; transition: border-color 0.2s; }
    .fm-search:focus { border-color: var(--green); }
    .fm-search::placeholder { color: var(--muted); }
    .fm-count { font-size: 0.68rem; color: var(--muted); white-space: nowrap; }
    .fm-shell { border: 1px solid var(--border); background: var(--surface); overflow: hidden; }
    .fm-header { display: grid; grid-template-columns: 28px 1fr 90px 90px 110px; padding: 10px 16px; border-bottom: 1px solid var(--border); background: var(--header-bg); font-size: 0.62rem; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); user-select: none; }
    .fm-row { display: grid; grid-template-columns: 28px 1fr 90px 90px 110px; padding: 0 16px; border-bottom: 1px solid var(--border); align-items: center; min-height: 46px; cursor: pointer; transition: background 0.12s; text-decoration: none; color: inherit; }
    .fm-row:last-child { border-bottom: none; }
    .fm-row:hover { background: var(--green-dim); }
    .fm-row.fm-folder:hover .fm-name { color: var(--green); }
    .fm-icon { font-size: 0.95rem; }
    .fm-name { font-size: 0.8rem; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 12px; transition: color 0.15s; }
    .fm-name.folder-name { color: var(--blue); font-weight: 700; }
    .fm-version { font-size: 0.7rem; color: var(--amber); }
    .fm-size { font-size: 0.7rem; color: var(--muted); }
    .fm-action { display: flex; justify-content: flex-end; }
    .fm-dl-btn { font-family: 'JetBrains Mono', monospace; font-size: 0.62rem; letter-spacing: 0.08em; text-transform: uppercase; padding: 5px 12px; border: 1px solid var(--border); color: var(--muted); text-decoration: none; transition: border-color 0.2s, color 0.2s; white-space: nowrap; }
    .fm-dl-btn:hover { border-color: var(--green); color: var(--green); }
    .fm-up .fm-name { color: var(--muted); font-style: italic; }
    .fm-empty { padding: 52px; text-align: center; font-size: 0.78rem; color: var(--muted); line-height: 1.8; }

    /* HOW IT WORKS */
    .how-section { max-width: 960px; margin: 0 auto; padding: 0 40px 80px; }
    .steps { display: flex; flex-direction: column; }
    .step { display: flex; border: 1px solid var(--border); border-bottom: none; background: var(--surface); overflow: hidden; }
    .step:last-child { border-bottom: 1px solid var(--border); }
    .step-num { padding: 24px; background: var(--green-dim); border-right: 1px solid var(--border); font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--green); min-width: 70px; text-align: center; display: flex; align-items: center; justify-content: center; }
    .step-content { padding: 24px 28px; }
    .step-title { font-size: 0.82rem; font-weight: 700; color: var(--text); margin-bottom: 8px; }
    .step-body { font-size: 0.74rem; color: var(--muted); line-height: 1.7; }
    .step-code { font-size: 0.75rem; color: var(--green); background: rgba(0,255,136,0.06); border: 1px solid var(--border); padding: 8px 14px; margin-top: 10px; display: inline-block; }

    /* THEME TOGGLE */
    .theme-toggle { background: none; border: 1px solid var(--border); color: var(--muted); font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; letter-spacing: 0.1em; padding: 5px 12px; cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 6px; transition: border-color 0.2s, color 0.2s !important; white-space: nowrap; }
    .theme-toggle:hover { border-color: var(--green); color: var(--green); }
    .theme-icon { font-size: 0.85rem; transition: transform 0.4s ease !important; }
    :root.light .theme-icon { transform: rotate(180deg); }

    /* FOOTER */
    footer { border-top: 1px solid var(--border); padding: 28px 40px; display: flex; justify-content: space-between; align-items: center; font-size: 0.68rem; color: var(--muted); }
    .footer-logo { color: var(--green); font-weight: 700; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    .reveal { opacity: 0; transform: translateY(20px); transition: opacity 0.5s, transform 0.5s; }
    .reveal.visible { opacity: 1; transform: translateY(0); }

    @media (max-width: 640px) {
      .hero, .fm-section { padding-left: 16px; padding-right: 16px; }
      .topbar { padding: 10px 16px; }
      .fm-header, .fm-row { grid-template-columns: 24px 1fr 0 70px 80px; }
      .fm-header > :nth-child(3), .fm-row > :nth-child(3) { display: none; }
      footer { flex-direction: column; gap: 10px; text-align: center; }
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="topbar-dot dot-red"></div>
    <div class="topbar-dot dot-yellow"></div>
    <div class="topbar-dot dot-green"></div>
    <span class="topbar-title">androstudio &mdash; pkg repository</span>
    <div class="topbar-status"><div class="status-dot"></div><span>repo online</span></div>
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode">
      <span class="theme-icon" id="themeIcon">&#9790;</span>
      <span id="themeLabel">Light</span>
    </button>
  </div>

  <div class="hero">
    <span class="hero-label">// Official Package Repository</span>
    <h1 class="hero-title">Andro<span>Studio</span></h1>
    <p class="hero-sub">PKG Repository</p>
    <p class="hero-desc">
      Official package repository for AndroStudio's built-in terminal.
      Built for <strong style="color:var(--text)">aarch64</strong> Android devices.
    </p>
    <div class="install-block">
      <span class="install-block-label">Install a package</span>
      <div class="cmd-line">
        <span class="prompt">$</span><span class="cmd" id="cmd1">pkg install git</span>
        <button class="copy-btn" onclick="copyCmd('cmd1',this)">copy</button>
      </div>
      <div class="cmd-line">
        <span class="prompt">$</span><span class="cmd" id="cmd2">pkg install python</span>
        <button class="copy-btn" onclick="copyCmd('cmd2',this)">copy</button>
      </div>
      <div class="cmd-line">
        <span class="prompt">$</span><span class="cmd" id="cmd3">pkg install micro</span>
        <button class="copy-btn" onclick="copyCmd('cmd3',this)">copy</button>
      </div>
    </div>
  </div>

  <div class="fm-section">
    <div class="divider reveal">
      <div class="divider-line"></div>
      <span class="divider-text">pool / main</span>
      <div class="divider-line"></div>
    </div>

    <div class="fm-breadcrumb" id="breadcrumb">
      <a onclick="navigateTo(null)">pool/main</a>
    </div>

    <div class="fm-toolbar reveal">
      <input class="fm-search" id="searchInput" type="text" placeholder="Search packages..." oninput="renderView()"/>
      <span class="fm-count" id="itemCount"></span>
    </div>

    <div class="fm-shell reveal">
      <div class="fm-header">
        <div></div><div>Name</div><div>Version</div><div>Size</div><div></div>
      </div>
      <div id="fmBody"><div class="fm-empty">Loading packages...</div></div>
    </div>
  </div>

  <!-- How It Works -->
  <div class="how-section">
    <div class="divider reveal">
      <div class="divider-line"></div>
      <span class="divider-text">How It Works</span>
      <div class="divider-line"></div>
    </div>
    <div class="steps">
      <div class="step reveal">
        <div class="step-num">1</div>
        <div class="step-content">
          <p class="step-title">Open AndroStudio Terminal</p>
          <p class="step-body">Launch AndroStudio on your Android device and open the built-in Termux terminal from the sidebar or terminal tab.</p>
        </div>
      </div>
      <div class="step reveal">
        <div class="step-num">2</div>
        <div class="step-content">
          <p class="step-title">Update Package Index</p>
          <p class="step-body">Fetch the latest package list from all repositories including this one.</p>
          <code class="step-code">pkg update</code>
        </div>
      </div>
      <div class="step reveal">
        <div class="step-num">3</div>
        <div class="step-content">
          <p class="step-title">Install Any Package</p>
          <p class="step-body">Install packages by name. Multiple packages can be installed in a single command.</p>
          <code class="step-code">pkg install git python nano curl</code>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <span><span class="footer-logo">AndroStudio</span> &mdash; PKG Repository &middot; aarch64</span>
    <span>Hosted on GitHub Pages &middot; <a href="https://github.com/devjhr" style="color:var(--green);text-decoration:none;">@devjhr</a></span>
  </footer>

  <script>
    const REPO_BASE = 'https://devjhr.github.io/pkg-repo';
    let allPackages = {};  // Will store the full package data
    let currentPath = null; // Current letter folder (e.g., 'a', 'b', etc.)

    // Load packages.json
    fetch('packages.json')
      .then(r => { if (!r.ok) throw new Error(); return r.json(); })
      .then(data => { 
        allPackages = data; 
        renderView(); 
      })
      .catch(() => {
        document.getElementById('fmBody').innerHTML =
          '<div class="fm-empty">packages.json not found.<br>Run <strong style="color:var(--green)">python generate_repo.py</strong> then push to GitHub.</div>';
      });

    function navigateTo(folder) {
      currentPath = folder;
      document.getElementById('searchInput').value = '';
      renderView();
    }

    function getAllPackagesFlat() {
      // Flatten all packages for search functionality
      const flat = [];
      for (const [letter, packages] of Object.entries(allPackages)) {
        for (const [pkgName, versions] of Object.entries(packages)) {
          versions.forEach(version => {
            flat.push({
              ...version,
              letter: letter,
              packageName: pkgName
            });
          });
        }
      }
      return flat;
    }

    function renderView() {
      const query = document.getElementById('searchInput').value.trim().toLowerCase();
      const body = document.getElementById('fmBody');
      const crumb = document.getElementById('breadcrumb');
      let html = '', count = 0;

      if (currentPath === null) {
        // ROOT â€” show letter folders
        crumb.innerHTML = '<span style="color:var(--green)">pool/main</span>';

        if (query) {
          // Search across all packages
          const flatPackages = getAllPackagesFlat();
          const matches = flatPackages.filter(pkg => 
            pkg.name.toLowerCase().includes(query) || 
            (pkg.package || '').toLowerCase().includes(query) ||
            (pkg.desc || '').toLowerCase().includes(query)
          );
          
          count = matches.length;
          html = matches.length
            ? matches.map(pkg => fileRow(pkg)).join('')
            : '<div class="fm-empty">No packages match "' + escHtml(query) + '"</div>';
        } else {
          // Show letter folders
          const letters = Object.keys(allPackages).sort();
          count = letters.length;
          
          if (!letters.length) {
            html = '<div class="fm-empty">No packages yet.<br>Drop .deb files into pool/main/[letter]/[package]/ and run generate_repo.py</div>';
          } else {
            html = letters.map(letter => {
              // Count total packages in this letter folder
              let totalPkgs = 0;
              if (allPackages[letter]) {
                Object.values(allPackages[letter]).forEach(versions => {
                  totalPkgs += versions.length;
                });
              }
              
              return '<div class="fm-row fm-folder" onclick="navigateTo(\'' + letter + '\')">' +
                '<div class="fm-icon">&#128193;</div>' +
                '<div class="fm-name folder-name">' + letter + '/</div>' +
                '<div class="fm-version" style="color:var(--muted)">' + totalPkgs + ' pkg' + (totalPkgs !== 1 ? 's' : '') + '</div>' +
                '<div class="fm-size"></div>' +
                '<div class="fm-action"></div>' +
              '</div>';
            }).join('');
          }
        }

      } else {
        // FOLDER VIEW - show packages in selected letter
        crumb.innerHTML = '<a onclick="navigateTo(null)">pool/main</a> <span>/</span> <span style="color:var(--green)">' + currentPath + '/</span>';
        
        // Get all packages for this letter
        const letterPackages = allPackages[currentPath] || {};
        const allVersions = [];
        
        for (const [pkgName, versions] of Object.entries(letterPackages)) {
          versions.forEach(version => {
            allVersions.push({
              ...version,
              letter: currentPath,
              packageName: pkgName
            });
          });
        }
        
        // Filter by search query if any
        let files = query 
          ? allVersions.filter(pkg => 
              pkg.name.toLowerCase().includes(query) || 
              (pkg.package || '').toLowerCase().includes(query) ||
              (pkg.desc || '').toLowerCase().includes(query)
            )
          : allVersions;
        
        // Sort files by package name
        files.sort((a, b) => (a.package || a.name).localeCompare(b.package || b.name));
        
        count = files.length;

        html = '<div class="fm-row fm-up" onclick="navigateTo(null)">' +
          '<div class="fm-icon">&#8617;</div>' +
          '<div class="fm-name">.. (go back)</div>' +
          '<div class="fm-version"></div><div class="fm-size"></div><div class="fm-action"></div>' +
        '</div>';

        html += files.length
          ? files.map(f => fileRow(f)).join('')
          : '<div class="fm-empty">No packages match your search.</div>';
      }

      body.innerHTML = html;
      const label = currentPath ? 'package' : (query ? 'result' : 'folder');
      document.getElementById('itemCount').textContent = count + ' ' + label + (count !== 1 ? 's' : '');
    }

    function fileRow(f) {
      const dlUrl = REPO_BASE + '/' + f.path;
      const sizeKB = f.size ? (f.size / 1024).toFixed(0) + ' KB' : '-';
      const desc = f.desc ? ' title="' + escHtml(f.desc) + '"' : '';
      
      return '<div class="fm-row"' + desc + '>' +
        '<div class="fm-icon">&#128230;</div>' +
        '<div class="fm-name">' + escHtml(f.name) + '</div>' +
        '<div class="fm-version">' + escHtml(f.version || '-') + '</div>' +
        '<div class="fm-size">' + sizeKB + '</div>' +
        '<div class="fm-action"><a class="fm-dl-btn" href="' + dlUrl + '" download>Download</a></div>' +
      '</div>';
    }

    function escHtml(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function copyCmd(id, btn) {
      navigator.clipboard.writeText(document.getElementById(id).textContent).then(() => {
        btn.textContent = 'copied!'; btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'copy'; btn.classList.remove('copied'); }, 2000);
      });
    }

    // Scroll reveal
    const obs = new IntersectionObserver(entries => {
      entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
    }, { threshold: 0.1 });
    document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

    // Theme toggle functionality
    const root = document.documentElement;
    const toggleBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeLabel = document.getElementById('themeLabel');

    function applyTheme(isLight) {
      root.classList.toggle('light', isLight);
      themeIcon.innerHTML = isLight ? '&#9788;' : '&#9790;';
      themeLabel.textContent = isLight ? 'Dark' : 'Light';
    }

    function toggleTheme() {
      const isLight = !root.classList.contains('light');
      applyTheme(isLight);
      localStorage.setItem('as-theme', isLight ? 'light' : 'dark');
    }

    // On load: check saved pref, else follow system
    (function() {
      const saved = localStorage.getItem('as-theme');
      const system = window.matchMedia('(prefers-color-scheme: light)').matches;
      applyTheme(saved ? saved === 'light' : system);
    })();

    // Auto-switch when system preference changes (only if user hasn't manually set a pref)
    window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', e => {
      if (!localStorage.getItem('as-theme')) applyTheme(e.matches);
    });
</script>
</body>
</html>


